$(document).ready(function(){function r(a){function e(r,a,e){var n,o,t={};for(n in a)o=a[n],n in r&&(r[n]===o||n in t&&t[n]===o)||(r[n]=e?e(o):o);return r}if(!a||"object"!=typeof a||"[object Function]"===Object.prototype.toString.call(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var n,o,t;if(a instanceof Array)for(n=[],o=0,t=a.length;t>o;++o)o in a&&n.push(r(a[o]));else n=a.constructor?new a.constructor:{};return e(n,a,r)}for(var a=10,e=30,n=1,o=4,t=new Array(e),i=0;e>i;i++)t[i]=new Array(e);for(var c=new Array(e),i=0;e>i;i++)c[i]=new Array(e);for(var l=new Array(e),i=0;e>i;i++)l[i]=new Array(e);for(var f=new Array(e),i=0;e>i;i++)f[i]=new Array(e);var s;$("#back").hide();var d=function(){$(".turn .name").text("Player"+n),$("#player_color").removeClass(),$("#player_color").addClass("player"+n);var r=n>1?n-1:o;$("#back").removeClass(),$("#back").addClass("player"+r)},u=function(){n++,n>o&&(n=1),d()},v=function(){n--,0>=n&&(n=o),d()},h=function(){$("#back").hide(),""!=$("#numOfPlayer").val()&&(o=$(".numberOfPlayer .selected").html()),""!=$("#size").val()&&(a=$(".size .selected").html()),n=1,d();for(var r=0;a>r;r++)for(var e=0;a>e;e++)t[r][e]=0,l[r][e]=0;for(var r=0;a>r;r++)for(var e=0;a>e;e++)c[r][e]=!1,f[r][e]=!1;for(var r=0;a>r;r++)c[0][r]=!0;for(var r=0;a>r;r++)c[r][0]=!0;for(var r=0;a>r;r++)c[r][a-1]=!0;for(var r=0;a>r;r++)c[a-1][r]=!0;$("#wrapper").html("");for(var i=$("#wrapper").width(),s=2,u=Math.floor(i/a)-2*s,r=0;a>r;r++)for(var e=0;a>e;e++)$("#wrapper").append('<div data-row="'+r+'" data-column="'+e+'" class="check"></div>'),$(".check").css({width:u,height:u})},w=function(){for(var r=0;a>r;r++)for(var e=0;a>e;e++)c[r][e]=!1};$(window).resize(function(){var r=$("#wrapper").width(),e=2,n=Math.floor(r/a)-2*e;$(".check").css({width:n,height:n})}),h(),$(document).on("click tap",".numberOfPlayer li",function(){$(".numberOfPlayer li").removeClass(),$(this).addClass("selected")}),$(document).on("click tap",".size li",function(){$(".size li").removeClass(),$(this).addClass("selected")});var k,p,y;$(document).on("click tap",".check",function(){function e(){h++}function o(){m--}function i(){m++}function d(r,e){var n=a-1;return 0>r||r>n||0>e||e>n?!0:!1}function v(r,e){h=p,m=y;var n=g-1,o=a-1;"up"==r?0>p-n&&(n=p):"down"==r&&p+n>o&&(n=o-p),"left"==e?0>y-n&&(n=y):"right"==e&&y+n>o&&(n=o-y),"up"==r?h=p-n:"down"==r&&(h=p+n),"left"==e?m=y-n:"right"==e&&(m=y+n),h>a&&(h=a),m>a&&(m=a),0>h&&(h=0),0>m&&(m=0)}if(p=$(this).data("row"),y=$(this).data("column"),1==c[p][y]){l=r(t),f=r(c),$("#back").show(),s=this,$(this).addClass("player"+n),t[p][y]=n,k=$(".lastClicked"),$(".check").removeClass("lastClicked"),$(this).addClass("lastClicked");var h,m;h=p,can=!0;for(var b=0;p>b;b++)0==t[b][y]&&(can=!1);if(can){do{if(0!=p&&0==t[p-1][y])break;if(h++,h>=a)break}while(0!=t[h][y]);a>h&&(c[h][y]=!0)}h=p,can=!0;for(var b=a-1;b>p;b--)0==t[b][y]&&(can=!1);if(can){do{if(p!=a-1&&0==t[p+1][y])break;if(h--,0>h)break}while(0!=t[h][y]);h>=0&&(c[h][y]=!0)}m=y,can=!0;for(var b=0;y>b;b++)0==t[p][b]&&(can=!1);if(can){do{if(0!=y&&0==t[p][y-1])break;if(m++,m>=a)break}while(0!=t[p][m]);a>m&&(c[p][m]=!0)}m=y,can=!0;for(var b=a-1;b>y;b--)0==t[p][b]&&(can=!1);if(can){do{if(y!=a-1&&0==t[p][y+1])break;if(m--,0>m)break}while(0!=t[p][m]);m>=0&&(c[p][m]=!0)}var C=(new Array(8),0),g=4,A=!1;v("up","left"),C=0;for(var b=0;7>b&&(t[h][m]==n?(C++,C==g&&(A=!0)):C=0,e(),i(),!d(h,m));b++);v("up","right"),C=0;for(var b=0;7>b&&(t[h][m]==n?(C++,C==g&&(A=!0)):C=0,e(),o(),!d(h,m));b++);v("","left"),C=0;for(var b=0;7>b&&(t[h][m]==n?(C++,C==g&&(A=!0)):C=0,i(),!d(h,m));b++);v("up",""),C=0;for(var b=0;7>b&&(t[h][m]==n?(C++,C==g&&(A=!0)):C=0,e(),!d(h,m));b++);A?(swal({title:"Congratulations!",text:"Player"+n+" won the game!"}),w(),$("#back").hide()):u(),c[p][y]=!1,console.log("status",t)}}),$("#new_game").click(function(){$("#numOfPlayer").val()<=1?alert("At least 2 players"):$("#size").val()<5||$("#size").val()>30?alert("Range of size: 5-30"):window.confirm("Are you sure to start a new game?")&&h()}),$("#back").click(function(){return t=r(l),c=r(f),v(),$(s).removeClass("player"+n),console.log(s),$(".check").removeClass("lastClicked"),$(k).addClass("lastClicked"),$("#back").hide(),!1})});