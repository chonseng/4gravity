$(document).ready(function(){function r(a){function e(r,a,e){var o,n,i={};for(o in a)n=a[o],o in r&&(r[o]===n||o in i&&i[o]===n)||(r[o]=e?e(n):n);return r}if(!a||"object"!=typeof a||"[object Function]"===Object.prototype.toString.call(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var o,n,i;if(a instanceof Array)for(o=[],n=0,i=a.length;i>n;++n)n in a&&o.push(r(a[n]));else o=a.constructor?new a.constructor:{};return e(o,a,r)}for(var a=10,e=30,o=1,n=4,i=new Array(e),f=0;e>f;f++)i[f]=new Array(e);for(var c=new Array(e),f=0;e>f;f++)c[f]=new Array(e);for(var t=new Array(e),f=0;e>f;f++)t[f]=new Array(e);for(var l=new Array(e),f=0;e>f;f++)l[f]=new Array(e);var v;$("#back").hide();var s=function(){$(".turn .name").text("Player"+o),$("#player_color").removeClass(),$("#player_color").addClass("player"+o);var r=o>1?o-1:n;$("#back").removeClass(),$("#back").addClass("player"+r)},u=function(){o++,o>n&&(o=1),s()},w=function(){o--,0>=o&&(o=n),s()},d=function(){$("#back").hide(),""!=$("#numOfPlayer").val()&&(n=$("#numOfPlayer").val()),""!=$("#size").val()&&(a=$("#size").val()),o=1,s();for(var r=0;a>r;r++)for(var e=0;a>e;e++)i[r][e]=0,t[r][e]=0;for(var r=0;a>r;r++)for(var e=0;a>e;e++)c[r][e]=!1,l[r][e]=!1;for(var r=0;a>r;r++)c[0][r]=!0;for(var r=0;a>r;r++)c[r][0]=!0;for(var r=0;a>r;r++)c[r][a-1]=!0;for(var r=0;a>r;r++)c[a-1][r]=!0;$("#wrapper").html("");for(var f=$("#wrapper").width(),v=2,u=Math.floor(f/a)-2*v,r=0;a>r;r++)for(var e=0;a>e;e++)$("#wrapper").append('<div data-row="'+r+'" data-column="'+e+'" class="check"></div>'),$(".check").css({width:u,height:u})},h=function(){for(var r=0;a>r;r++)for(var e=0;a>e;e++)c[r][e]=!1};$(window).resize(function(){var r=$("#wrapper").width(),e=2,o=Math.floor(r/a)-2*e;$(".check").css({width:o,height:o})}),d();var k,y;$(document).on("click tap",".check",function(){if(k=$(this).data("row"),y=$(this).data("column"),1==c[k][y]){t=r(i),l=r(c),$("#back").show(),v=this,$(this).addClass("player"+o),i[k][y]=o;var e,n;e=k,can=!0;for(var f=0;k>f;f++)0==i[f][y]&&(can=!1);if(can){do{if(0!=k&&0==i[k-1][y])break;if(e++,e>=a)break}while(0!=i[e][y]);a>e&&(c[e][y]=!0)}e=k,can=!0;for(var f=a-1;f>k;f--)0==i[f][y]&&(can=!1);if(can){do{if(k!=a-1&&0==i[k+1][y])break;if(e--,0>e)break}while(0!=i[e][y]);e>=0&&(c[e][y]=!0)}n=y,can=!0;for(var f=0;y>f;f++)0==i[k][f]&&(can=!1);if(can){do{if(0!=y&&0==i[k][y-1])break;if(n++,n>=a)break}while(0!=i[k][n]);a>n&&(c[k][n]=!0)}n=y,can=!0;for(var f=a-1;f>y;f--)0==i[k][f]&&(can=!1);if(can){do{if(y!=a-1&&0==i[k][y+1])break;if(n--,0>n)break}while(0!=i[k][n]);n>=0&&(c[k][n]=!0)}var s=new Array(8),w=0,d=4;s[0]=!0,w=0;for(var f=k-1;f>=0&&(i[f][y]!=o&&(s[0]=!1),w++,w!=d-1);f--);d-1>w&&(s[0]=!1),s[1]=!0,w=0;for(var f=k+1;a>f&&(i[f][y]!=o&&(s[1]=!1),w++,w!=d-1);f++);d-1>w&&(s[1]=!1),s[2]=!0,w=0;for(var f=y-1;f>=0&&(console.log(i[k][f]),i[k][f]!=o&&(s[2]=!1),w++,w!=d-1);f--);d-1>w&&(s[2]=!1),s[3]=!0,w=0;for(var f=y+1;a>f&&(i[k][f]!=o&&(s[3]=!1),w++,w!=d-1);f++);d-1>w&&(s[3]=!1),s[4]=!0,w=0,n=y,e=k;for(var f=0;d-1>f;f++){if(0>=e||0>=n){s[4]=!1;break}e--,n--,i[e][n]!=o&&(s[4]=!1)}s[5]=!0,w=0,n=y,e=k;for(var f=0;d-1>f;f++){if(0>=e||n>=a-1){s[5]=!1;break}e--,n++,i[e][n]!=o&&(s[5]=!1)}s[6]=!0,w=0,n=y,e=k;for(var f=0;d-1>f;f++){if(e>=a-1||0>=n){s[6]=!1;break}e++,n--,i[e][n]!=o&&(s[6]=!1)}s[7]=!0,w=0,n=y,e=k;for(var f=0;d-1>f;f++){if(e>=a-1||n>=a-1){s[7]=!1;break}e++,n++,i[e][n]!=o&&(s[7]=!1)}hasWon=!1;for(var f=0;8>f;f++)1==s[f]&&(hasWon=!0);hasWon?(alert("Player"+o+" won!"),h(),$("#back").hide()):u(),console.log(s),c[k][y]=!1,console.log("status",i)}}),$("#new_game").click(function(){$("#numOfPlayer").val()<=1?alert("At least 2 players"):$("#size").val()<5||$("#size").val()>30?alert("Range of size: 5-30"):window.confirm("Are you sure to start a new game?")&&d()}),$("#back").click(function(){return i=r(t),c=r(l),w(),$(v).removeClass("player"+o),$("#back").hide(),!1})});