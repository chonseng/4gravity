$(document).ready(function(){function r(e){function a(r,e,a){var o,n,t={};for(o in e)n=e[o],o in r&&(r[o]===n||o in t&&t[o]===n)||(r[o]=a?a(n):n);return r}if(!e||"object"!=typeof e||"[object Function]"===Object.prototype.toString.call(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var o,n,t;if(e instanceof Array)for(o=[],n=0,t=e.length;t>n;++n)n in e&&o.push(r(e[n]));else o=e.constructor?new e.constructor:{};return a(o,e,r)}for(var e=10,a=30,o=1,n=4,t=new Array(a),c=0;a>c;c++)t[c]=new Array(a);for(var l=new Array(a),c=0;a>c;c++)l[c]=new Array(a);for(var i=new Array(a),c=0;a>c;c++)i[c]=new Array(a);for(var f=new Array(a),c=0;a>c;c++)f[c]=new Array(a);var s;$("#back").hide();var u=function(){$(".turn .name").text("Player"+o),$("#player_color").removeClass(),$("#player_color").addClass("player"+o);var r=o>1?o-1:n;$("#back").removeClass(),$("#back").addClass("player"+r)},d=function(){o++,o>n&&(o=1),u()},v=function(){o--,0>=o&&(o=n),u()},h=function(){$("#back").hide(),""!=$("#numOfPlayer").val()&&(n=$(".numberOfPlayer .selected").html()),""!=$("#size").val()&&(e=$(".size .selected").html()),o=1,u();for(var r=0;e>r;r++)for(var a=0;e>a;a++)t[r][a]=0,i[r][a]=0;for(var r=0;e>r;r++)for(var a=0;e>a;a++)l[r][a]=!1,f[r][a]=!1;for(var r=0;e>r;r++)l[0][r]=!0;for(var r=0;e>r;r++)l[r][0]=!0;for(var r=0;e>r;r++)l[r][e-1]=!0;for(var r=0;e>r;r++)l[e-1][r]=!0;$("#wrapper").html("");for(var c=$("#wrapper").width(),s=2,d=Math.floor(c/e)-2*s,r=0;e>r;r++)for(var a=0;e>a;a++)$("#wrapper").append('<div data-row="'+r+'" data-column="'+a+'" class="check"></div>'),$(".check").css({width:d,height:d})},w=function(){for(var r=0;e>r;r++)for(var a=0;e>a;a++)l[r][a]=!1};$(window).resize(function(){var r=$("#wrapper").width(),a=2,o=Math.floor(r/e)-2*a;$(".check").css({width:o,height:o})}),h(),$(document).on("click tap",".numberOfPlayer li",function(){$(".numberOfPlayer li").removeClass(),$(this).addClass("selected")}),$(document).on("click tap",".size li",function(){$(".size li").removeClass(),$(this).addClass("selected")});var p,m;$(document).on("click tap",".check",function(){function a(){h++}function n(){y--}function c(){y++}function u(r,a){var o=e-1;return 0>r||r>o||0>a||a>o?!0:!1}function v(r,a){h=p,y=m;var o=C-1,n=e-1;"up"==r?0>p-o&&(o=p):"down"==r&&p+o>n&&(o=n-p),"left"==a?0>m-o&&(o=m):"right"==a&&m+o>n&&(o=n-m),console.log(o),"up"==r?h=p-o:"down"==r&&(h=p+o),"left"==a?y=m-o:"right"==a&&(y=m+o),h>e&&(h=e),y>e&&(y=e),0>h&&(h=0),0>y&&(y=0)}if(p=$(this).data("row"),m=$(this).data("column"),1==l[p][m]){i=r(t),f=r(l),$("#back").show(),s=this,$(this).addClass("player"+o),t[p][m]=o,$(".check").removeClass("lastClicked"),$(this).addClass("lastClicked");var h,y;h=p,can=!0;for(var k=0;p>k;k++)0==t[k][m]&&(can=!1);if(can){do{if(0!=p&&0==t[p-1][m])break;if(h++,h>=e)break}while(0!=t[h][m]);e>h&&(l[h][m]=!0)}h=p,can=!0;for(var k=e-1;k>p;k--)0==t[k][m]&&(can=!1);if(can){do{if(p!=e-1&&0==t[p+1][m])break;if(h--,0>h)break}while(0!=t[h][m]);h>=0&&(l[h][m]=!0)}y=m,can=!0;for(var k=0;m>k;k++)0==t[p][k]&&(can=!1);if(can){do{if(0!=m&&0==t[p][m-1])break;if(y++,y>=e)break}while(0!=t[p][y]);e>y&&(l[p][y]=!0)}y=m,can=!0;for(var k=e-1;k>m;k--)0==t[p][k]&&(can=!1);if(can){do{if(m!=e-1&&0==t[p][m+1])break;if(y--,0>y)break}while(0!=t[p][y]);y>=0&&(l[p][y]=!0)}var g=new Array(8),b=0,C=4,A=!1;v("up","left"),b=0;for(var k=0;7>k&&(t[h][y]==o?(b++,b==C&&(A=!0)):b=0,a(),c(),!u(h,y));k++);console.log(A),console.log("-------------*************************-------------"),v("up","right"),b=0,console.log("row",p),console.log("column",m);for(var k=0;7>k&&(console.log("tmp_row",h),console.log("tmp_column",y),console.log("tmp_row",h),console.log("turn",o),console.log("count",b),t[h][y]==o?(b++,b==C&&(A=!0)):b=0,a(),n(),!u(h,y));k++);v("","left"),b=0;for(var k=0;7>k&&(t[h][y]==o?(b++,b==C&&(A=!0)):b=0,c(),!u(h,y));k++);v("up",""),b=0;for(var k=0;7>k&&(t[h][y]==o?(b++,b==C&&(A=!0)):b=0,a(),!u(h,y));k++);A?(swal({title:"Congratulations!",text:"Player"+o+" won the game!"}),w(),$("#back").hide()):d(),console.log(g),l[p][m]=!1,console.log("status",t)}}),$("#new_game").click(function(){$("#numOfPlayer").val()<=1?alert("At least 2 players"):$("#size").val()<5||$("#size").val()>30?alert("Range of size: 5-30"):window.confirm("Are you sure to start a new game?")&&h()}),$("#back").click(function(){return t=r(i),l=r(f),v(),$(s).removeClass("player"+o),$("#back").hide(),!1})});