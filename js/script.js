$(document).ready(function(){function r(a){function e(r,a,e){var o,n,i={};for(o in a)n=a[o],o in r&&(r[o]===n||o in i&&i[o]===n)||(r[o]=e?e(n):n);return r}if(!a||"object"!=typeof a||"[object Function]"===Object.prototype.toString.call(a))return a;if(a.nodeType&&"cloneNode"in a)return a.cloneNode(!0);if(a instanceof Date)return new Date(a.getTime());if(a instanceof RegExp)return new RegExp(a);var o,n,i;if(a instanceof Array)for(o=[],n=0,i=a.length;i>n;++n)n in a&&o.push(r(a[n]));else o=a.constructor?new a.constructor:{};return e(o,a,r)}for(var a=10,e=30,o=1,n=4,i=new Array(e),t=0;e>t;t++)i[t]=new Array(e);for(var c=new Array(e),t=0;e>t;t++)c[t]=new Array(e);for(var f=new Array(e),t=0;e>t;t++)f[t]=new Array(e);for(var l=new Array(e),t=0;e>t;t++)l[t]=new Array(e);var s;$("#back").hide();var v=function(){$(".turn .name").text("Player"+o),$("#player_color").removeClass(),$("#player_color").addClass("player"+o);var r=o>1?o-1:n;$("#back").removeClass(),$("#back").addClass("player"+r)},d=function(){o++,o>n&&(o=1),v()},u=function(){o--,0>=o&&(o=n),v()},h=function(){$("#back").hide(),""!=$("#numOfPlayer").val()&&(n=$(".numberOfPlayer .selected").html()),""!=$("#size").val()&&(a=$(".size .selected").html()),o=1,v();for(var r=0;a>r;r++)for(var e=0;a>e;e++)i[r][e]=0,f[r][e]=0;for(var r=0;a>r;r++)for(var e=0;a>e;e++)c[r][e]=!1,l[r][e]=!1;for(var r=0;a>r;r++)c[0][r]=!0;for(var r=0;a>r;r++)c[r][0]=!0;for(var r=0;a>r;r++)c[r][a-1]=!0;for(var r=0;a>r;r++)c[a-1][r]=!0;$("#wrapper").html("");for(var t=$("#wrapper").width(),s=2,d=Math.floor(t/a)-2*s,r=0;a>r;r++)for(var e=0;a>e;e++)$("#wrapper").append('<div data-row="'+r+'" data-column="'+e+'" class="check"></div>'),$(".check").css({width:d,height:d})},w=function(){for(var r=0;a>r;r++)for(var e=0;a>e;e++)c[r][e]=!1};$(window).resize(function(){var r=$("#wrapper").width(),e=2,o=Math.floor(r/a)-2*e;$(".check").css({width:o,height:o})}),h(),$(document).on("click tap",".numberOfPlayer li",function(){$(".numberOfPlayer li").removeClass(),$(this).addClass("selected")}),$(document).on("click tap",".size li",function(){$(".size li").removeClass(),$(this).addClass("selected")});var k,y;$(document).on("click tap",".check",function(){if(k=$(this).data("row"),y=$(this).data("column"),1==c[k][y]){f=r(i),l=r(c),$("#back").show(),s=this,$(this).addClass("player"+o),i[k][y]=o;var e,n;e=k,can=!0;for(var t=0;k>t;t++)0==i[t][y]&&(can=!1);if(can){do{if(0!=k&&0==i[k-1][y])break;if(e++,e>=a)break}while(0!=i[e][y]);a>e&&(c[e][y]=!0)}e=k,can=!0;for(var t=a-1;t>k;t--)0==i[t][y]&&(can=!1);if(can){do{if(k!=a-1&&0==i[k+1][y])break;if(e--,0>e)break}while(0!=i[e][y]);e>=0&&(c[e][y]=!0)}n=y,can=!0;for(var t=0;y>t;t++)0==i[k][t]&&(can=!1);if(can){do{if(0!=y&&0==i[k][y-1])break;if(n++,n>=a)break}while(0!=i[k][n]);a>n&&(c[k][n]=!0)}n=y,can=!0;for(var t=a-1;t>y;t--)0==i[k][t]&&(can=!1);if(can){do{if(y!=a-1&&0==i[k][y+1])break;if(n--,0>n)break}while(0!=i[k][n]);n>=0&&(c[k][n]=!0)}var v=new Array(8),u=0,h=4;v[0]=!0,u=0;for(var t=k-1;t>=0&&(i[t][y]!=o&&(v[0]=!1),u++,u!=h-1);t--);h-1>u&&(v[0]=!1),v[1]=!0,u=0;for(var t=k+1;a>t&&(i[t][y]!=o&&(v[1]=!1),u++,u!=h-1);t++);h-1>u&&(v[1]=!1),v[2]=!0,u=0;for(var t=y-1;t>=0&&(console.log(i[k][t]),i[k][t]!=o&&(v[2]=!1),u++,u!=h-1);t--);h-1>u&&(v[2]=!1),v[3]=!0,u=0;for(var t=y+1;a>t&&(i[k][t]!=o&&(v[3]=!1),u++,u!=h-1);t++);h-1>u&&(v[3]=!1),v[4]=!0,u=0,n=y,e=k;for(var t=0;h-1>t;t++){if(0>=e||0>=n){v[4]=!1;break}e--,n--,i[e][n]!=o&&(v[4]=!1)}v[5]=!0,u=0,n=y,e=k;for(var t=0;h-1>t;t++){if(0>=e||n>=a-1){v[5]=!1;break}e--,n++,i[e][n]!=o&&(v[5]=!1)}v[6]=!0,u=0,n=y,e=k;for(var t=0;h-1>t;t++){if(e>=a-1||0>=n){v[6]=!1;break}e++,n--,i[e][n]!=o&&(v[6]=!1)}v[7]=!0,u=0,n=y,e=k;for(var t=0;h-1>t;t++){if(e>=a-1||n>=a-1){v[7]=!1;break}e++,n++,i[e][n]!=o&&(v[7]=!1)}hasWon=!1;for(var t=0;8>t;t++)1==v[t]&&(hasWon=!0);hasWon?(alert("Player"+o+" won!"),w(),$("#back").hide()):d(),console.log(v),c[k][y]=!1,console.log("status",i)}}),$("#new_game").click(function(){$("#numOfPlayer").val()<=1?alert("At least 2 players"):$("#size").val()<5||$("#size").val()>30?alert("Range of size: 5-30"):window.confirm("Are you sure to start a new game?")&&h()}),$("#back").click(function(){return i=r(f),c=r(l),u(),$(s).removeClass("player"+o),$("#back").hide(),!1})});