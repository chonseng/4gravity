$(document).ready(function(){function e(r){function a(e,r,a){var n,t,o={};for(n in r)t=r[n],n in e&&(e[n]===t||n in o&&o[n]===t)||(e[n]=a?a(t):t);return e}if(!r||"object"!=typeof r||"[object Function]"===Object.prototype.toString.call(r))return r;if(r.nodeType&&"cloneNode"in r)return r.cloneNode(!0);if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp)return new RegExp(r);var n,t,o;if(r instanceof Array)for(n=[],t=0,o=r.length;o>t;++t)t in r&&n.push(e(r[t]));else n=r.constructor?new r.constructor:{};return a(n,r,e)}for(var r=10,a=30,n=1,t=4,o=new Array(a),i=0;a>i;i++)o[i]=new Array(a);for(var c=new Array(a),i=0;a>i;i++)c[i]=new Array(a);for(var l=new Array(a),i=0;a>i;i++)l[i]=new Array(a);for(var s=new Array(a),i=0;a>i;i++)s[i]=new Array(a);var f;$("#back").hide(),$("#game").hide();var u=function(){$(".turn .name").text("Player"+n),$("#player_color").removeClass(),$("#player_color").addClass("player"+n);var e=n>1?n-1:t;$("#back").removeClass(),$("#back").addClass("player"+e)},d=function(){n++,n>t&&(n=1),u()},v=function(){n--,0>=n&&(n=t),u()},h=function(){$("#back").hide(),""!=$("#numOfPlayer").val()&&(t=$(".numberOfPlayer .selected").html()),""!=$("#size").val()&&(r=$(".size .selected").html()),n=1,u();for(var e=0;r>e;e++)for(var a=0;r>a;a++)o[e][a]=0,l[e][a]=0;for(var e=0;r>e;e++)for(var a=0;r>a;a++)c[e][a]=!1,s[e][a]=!1;for(var e=0;r>e;e++)c[0][e]=!0;for(var e=0;r>e;e++)c[e][0]=!0;for(var e=0;r>e;e++)c[e][r-1]=!0;for(var e=0;r>e;e++)c[r-1][e]=!0;$("#wrapper").html("");for(var i=$("#wrapper").width(),f=2,d=Math.floor(i/r)-2*f,e=0;r>e;e++)for(var a=0;r>a;a++)$("#wrapper").append('<div data-row="'+e+'" data-column="'+a+'" class="check"></div>'),$(".check").css({width:d,height:d})},w=function(){for(var e=0;r>e;e++)for(var a=0;r>a;a++)c[e][a]=!1};$(window).resize(function(){var e=$("#wrapper").width(),a=2,n=Math.floor(e/r)-2*a;$(".check").css({width:n,height:n})}),h(),$(document).on("click tap",".numberOfPlayer li",function(){$(".numberOfPlayer li").removeClass(),$(this).addClass("selected")}),$(document).on("click tap",".size li",function(){$(".size li").removeClass(),$(this).addClass("selected")});var p,m,k;$(document).on("click tap",".check",function(){function a(){h++}function t(){y--}function i(){y++}function u(e,a){var n=r-1;return 0>e||e>n||0>a||a>n?!0:!1}function v(e,a){h=m,y=k;var n=g-1,t=r-1;"up"==e?0>m-n&&(n=m):"down"==e&&m+n>t&&(n=t-m),"left"==a?0>k-n&&(n=k):"right"==a&&k+n>t&&(n=t-k),"up"==e?h=m-n:"down"==e&&(h=m+n),"left"==a?y=k-n:"right"==a&&(y=k+n),h>r&&(h=r),y>r&&(y=r),0>h&&(h=0),0>y&&(y=0)}if(m=$(this).data("row"),k=$(this).data("column"),1==c[m][k]){l=e(o),s=e(c),$("#back").show(),f=this,$(this).addClass("player"+n),o[m][k]=n,p=$(".lastClicked"),$(".check").removeClass("lastClicked"),$(this).addClass("lastClicked");var h,y;h=m,can=!0;for(var b=0;m>b;b++)0==o[b][k]&&(can=!1);if(can){do{if(0!=m&&0==o[m-1][k])break;if(h++,h>=r)break}while(0!=o[h][k]);r>h&&(c[h][k]=!0)}h=m,can=!0;for(var b=r-1;b>m;b--)0==o[b][k]&&(can=!1);if(can){do{if(m!=r-1&&0==o[m+1][k])break;if(h--,0>h)break}while(0!=o[h][k]);h>=0&&(c[h][k]=!0)}y=k,can=!0;for(var b=0;k>b;b++)0==o[m][b]&&(can=!1);if(can){do{if(0!=k&&0==o[m][k-1])break;if(y++,y>=r)break}while(0!=o[m][y]);r>y&&(c[m][y]=!0)}y=k,can=!0;for(var b=r-1;b>k;b--)0==o[m][b]&&(can=!1);if(can){do{if(k!=r-1&&0==o[m][k+1])break;if(y--,0>y)break}while(0!=o[m][y]);y>=0&&(c[m][y]=!0)}var C=(new Array(8),0),g=4,A=!1;v("up","left"),C=0;for(var b=0;7>b&&(o[h][y]==n?(C++,C==g&&(A=!0)):C=0,a(),i(),!u(h,y));b++);v("up","right"),C=0;for(var b=0;7>b&&(o[h][y]==n?(C++,C==g&&(A=!0)):C=0,a(),t(),!u(h,y));b++);v("","left"),C=0;for(var b=0;7>b&&(o[h][y]==n?(C++,C==g&&(A=!0)):C=0,i(),!u(h,y));b++);v("up",""),C=0;for(var b=0;7>b&&(o[h][y]==n?(C++,C==g&&(A=!0)):C=0,a(),!u(h,y));b++);A?(swal({title:"Congratulations!",text:"Player"+n+" won the game!"}),w(),$("#back").hide()):d(),c[m][k]=!1,console.log("status",o)}}),$("#new_game").click(function(){$("#numOfPlayer").val()<=1?alert("At least 2 players"):$("#size").val()<5||$("#size").val()>30?alert("Range of size: 5-30"):swal({title:"Are you sure to start a new game?",text:"You will not be able to recover this game progress!",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, start a new game!",closeOnConfirm:!0},function(){$("#game").show(),h()})}),$("#back").click(function(){return o=e(l),c=e(s),v(),$(f).removeClass("player"+n),console.log(f),$(".check").removeClass("lastClicked"),$(p).addClass("lastClicked"),$("#back").hide(),!1})});