$(document).ready(function(){function a(e){function r(a,e,r){var t,o,l={};for(t in e)o=e[t],t in a&&(a[t]===o||t in l&&l[t]===o)||(a[t]=r?r(o):o);return a}if(!e||"object"!=typeof e||"[object Function]"===Object.prototype.toString.call(e))return e;if(e.nodeType&&"cloneNode"in e)return e.cloneNode(!0);if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp)return new RegExp(e);var t,o,l;if(e instanceof Array)for(t=[],o=0,l=e.length;l>o;++o)o in e&&t.push(a(e[o]));else t=e.constructor?new e.constructor:{};return r(t,e,a)}var e=10,r=4,t=1,o=!1;if(console.log(localStorage.gameSetting),null!=localStorage.gameSetting&&""!=localStorage.gameSetting){var l=JSON.parse(localStorage.gameSetting).size,n=JSON.parse(localStorage.gameSetting).numOfPlayer;(null!=l||""!=l)&&(e=l),(null!=n||""!=n)&&(r=n)}$(".numOfPlayer li").removeClass(),$("#numOfPlayer-"+r).addClass("selected"),$(".size li").removeClass(),$("#size-"+e).addClass("selected");for(var s=30,i=new Array(s),c=0;s>c;c++)i[c]=new Array(s);for(var f=new Array(s),c=0;s>c;c++)f[c]=new Array(s);for(var u=new Array(s),c=0;s>c;c++)u[c]=new Array(s);for(var d=new Array(s),c=0;s>c;c++)d[c]=new Array(s);var v;$("#back").hide();var g=function(){$(".turn .name").text("Player"+t),$("#player_color").removeClass(),$("#player_color").addClass("player"+t);var a=t>1?t-1:r;$("#back").removeClass(),$("#back").addClass("player"+a)},m=function(){t++,t>r&&(t=1),g()},p=function(){t--,0>=t&&(t=r),g()},h=function(){o=!1,$("#back").hide(),""!=$("#numOfPlayer").val()&&(r=$(".numOfPlayer .selected").html()),""!=$("#size").val()&&(e=$(".size .selected").html()),t=1,g();for(var a=0;e>a;a++)for(var l=0;e>l;l++)i[a][l]=0,u[a][l]=0;for(var a=0;e>a;a++)for(var l=0;e>l;l++)f[a][l]=!1,d[a][l]=!1;for(var a=0;e>a;a++)f[0][a]=!0;for(var a=0;e>a;a++)f[a][0]=!0;for(var a=0;e>a;a++)f[a][e-1]=!0;for(var a=0;e>a;a++)f[e-1][a]=!0;$("#wrapper").html("");var n=$("#wrapper").width(),s=2,c=Math.floor(n/e)-2*s;console.log("SIZE",e);for(var a=0;e>a;a++)for(var l=0;e>l;l++)$("#wrapper").append('<div data-row="'+a+'" data-column="'+l+'" class="check"></div>'),$(".check").css({width:c,height:c});if(null!=localStorage.gameStatus&&""!=localStorage.gameStatus){console.log(JSON.parse(localStorage.gameStatus).status);for(var v=JSON.parse(localStorage.gameStatus).isvalid,m=JSON.parse(localStorage.gameStatus).status,p=JSON.parse(localStorage.gameStatus).pre_status,h=JSON.parse(localStorage.gameStatus).pre_isvalid,S=JSON.parse(localStorage.gameStatus).turn,a=0;e>a;a++)for(var l=0;e>l;l++)0!=m[a][l]&&(console.log('div[data-row="'+a+'"][data-column="'+l+'"]'),$('div[data-row="'+a+'"][data-column="'+l+'"]').addClass("player"+m[a][l]));f=v,i=m,u=p,d=h,t=S}var w={numOfPlayer:r,size:e};localStorage.gameSetting=JSON.stringify(w)},S=function(){o=!0;for(var a=0;e>a;a++)for(var r=0;e>r;r++)f[a][r]=!1};$(window).resize(function(){var a=$("#wrapper").width(),r=2,t=Math.floor(a/e)-2*r;$(".check").css({width:t,height:t})}),h(),g(),$(document).on("click tap",".numOfPlayer li",function(){$(".numOfPlayer li").removeClass(),$(this).addClass("selected")}),$(document).on("click tap",".size li",function(){$(".size li").removeClass(),$(this).addClass("selected")});var w,y,k;$(document).on("click tap",".check",function(){function r(){p++}function l(){h--}function n(){h++}function s(a,r){var t=e-1;return 0>a||a>t||0>r||r>t?!0:!1}function c(a,r){p=y,h=k;var t=O-1,o=e-1;"up"==a?0>y-t&&(t=y):"down"==a&&y+t>o&&(t=o-y),"left"==r?0>k-t&&(t=k):"right"==r&&k+t>o&&(t=o-k),"up"==a?p=y-t:"down"==a&&(p=y+t),"left"==r?h=k-t:"right"==r&&(h=k+t),p>e&&(p=e),h>e&&(h=e),0>p&&(p=0),0>h&&(h=0)}if(o){var g=$("#newGame").offset().top;$("html,body").animate({scrollTop:g},300)}if(y=$(this).data("row"),k=$(this).data("column"),1==f[y][k]){u=a(i),d=a(f),$("#back").show(),v=this,$(this).addClass("player"+t),i[y][k]=t,w=$(".lastClicked"),$(".check").removeClass("lastClicked"),$(this).addClass("lastClicked");var p,h;p=y,can=!0;for(var C=0;y>C;C++)0==i[C][k]&&(can=!1);if(can){do{if(0!=y&&0==i[y-1][k])break;if(p++,p>=e)break}while(0!=i[p][k]);e>p&&(f[p][k]=!0)}p=y,can=!0;for(var C=e-1;C>y;C--)0==i[C][k]&&(can=!1);if(can){do{if(y!=e-1&&0==i[y+1][k])break;if(p--,0>p)break}while(0!=i[p][k]);p>=0&&(f[p][k]=!0)}h=k,can=!0;for(var C=0;k>C;C++)0==i[y][C]&&(can=!1);if(can){do{if(0!=k&&0==i[y][k-1])break;if(h++,h>=e)break}while(0!=i[y][h]);e>h&&(f[y][h]=!0)}h=k,can=!0;for(var C=e-1;C>k;C--)0==i[y][C]&&(can=!1);if(can){do{if(k!=e-1&&0==i[y][k+1])break;if(h--,0>h)break}while(0!=i[y][h]);h>=0&&(f[y][h]=!0)}var b=(new Array(8),0),O=4,z=!1;c("up","left"),b=0;for(var C=0;7>C&&(i[p][h]==t?(b++,b==O&&(z=!0)):b=0,r(),n(),!s(p,h));C++);c("up","right"),b=0;for(var C=0;7>C&&(i[p][h]==t?(b++,b==O&&(z=!0)):b=0,r(),l(),!s(p,h));C++);c("","left"),b=0;for(var C=0;7>C&&(i[p][h]==t?(b++,b==O&&(z=!0)):b=0,n(),!s(p,h));C++);c("up",""),b=0;for(var C=0;7>C&&(i[p][h]==t?(b++,b==O&&(z=!0)):b=0,r(),!s(p,h));C++);z?(swal({title:"Congratulations!",text:"Player"+t+" won the game!"}),S(),$("#back").hide()):m(),f[y][k]=!1;var A={turn:t,status:i,isvalid:f,pre_status:u,pre_isvalid:d};localStorage.gameStatus=JSON.stringify(A)}}),$("#new_game").click(function(){$("#numOfPlayer").val()<=1?alert("At least 2 players"):$("#size").val()<5||$("#size").val()>30?alert("Range of size: 5-30"):swal({title:"Are you sure to start a new game?",text:"You will not be able to recover this game progress!",type:"info",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:"Yes, start a new game!",closeOnConfirm:!0},function(){$("#game").show(),localStorage.gameStatus="",h()})}),$("#back").click(function(){return i=a(u),f=a(d),p(),$(v).removeClass("player"+t),console.log(v),$(".check").removeClass("lastClicked"),$(w).addClass("lastClicked"),$("#back").hide(),!1})});